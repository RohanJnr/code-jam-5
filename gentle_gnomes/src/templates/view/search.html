<div class="mx-auto" style="width: 50%">
    <form action="/search" method="post" id="search-form">
        <div class="input-group mb-3">
            <!-- <label for="location">Location</label> -->
            <input type="text" name="name" class="form-control" id="name" required>
            <input type="hidden" name="location" id="location">
            <div class="input-group-append">
                <input value="Search" class="btn btn-outline-secondary" type="submit" id="button-addon2">
            </div>
        </div>
    </form>
</div>
<div id="map" style="display: none"></div>
<script>
    const inputName = document.getElementById('name');
    const inputLocation = document.getElementById('location');
    const form = document.getElementById('search-form');
    const map = document.getElementById('map');

    const restrictions = {'country': ['us']};
    autocomplete = new google.maps.places.Autocomplete(inputName);
    autocomplete.setFields(['geometry']);
    autocomplete.setComponentRestrictions(restrictions);

    const acService = new google.maps.places.AutocompleteService();
    const placesService = new google.maps.places.PlacesService(map);
    const sessionToken = new google.maps.places.AutocompleteSessionToken();

    function setLocation(location) {
        inputLocation.setAttribute('value', JSON.stringify(location));
    }

    function getTopLocation(predictions, status) {
        if (status !== google.maps.places.PlacesServiceStatus.OK) {
            console.error('Could not get predictions: status is ' + status);
            return;
        }

        const request = {
            fields: ['geometry.location'],
            placeId: predictions[0].place_id,
            sessionToken: sessionToken
        };

        placesService.getDetails(request, (result, status) => {
            if (status !== google.maps.places.PlacesServiceStatus.OK) {
                console.error('Could not get details: status is ' + status);
                return;
            }

            setLocation(result.geometry.location);
        });
    }

    form.addEventListener('submit', () => {
        const place = autocomplete.getPlace();

        if (place === undefined) {
            const request = {
                componentRestrictions: restrictions,
                input: inputName.value,
                sessionToken: sessionToken
            };

            acService.getPlacePredictions(request, getTopLocation);
        } else {
            setLocation(place.geometry.location);
        }
    });
</script>
